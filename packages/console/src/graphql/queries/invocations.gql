query InvocationsList(
  $limit: Int = 20
  $offset: Int = 0
  $where: invocations_bool_exp = {}
  $order_by: [invocations_order_by!] = { created_at: desc }
) {
  invocations(limit: $limit, offset: $offset, where: $where, order_by: $order_by) {
    id
    created_at
    updated_at
    source_function
    source_table
    source_operation
    source_system
    correlation_id
    source_user_email
    source_user_role
    total_duration_ms
    events_detected_count
    total_jobs_run
    total_jobs_succeeded
    total_jobs_failed
    status
    error_message
    source_event_payload
    event_executions_aggregate {
      aggregate {
        count
      }
    }
    detected_events: event_executions_aggregate(where: { detected: { _eq: true } }) {
      aggregate {
        count
      }
    }
    undetected_events: event_executions_aggregate(where: { detected: { _eq: false } }) {
      aggregate {
        count
      }
    }
  }

  invocations_aggregate(where: $where) {
    aggregate {
      count
    }
  }
}

query InvocationDetail($id: uuid!) {
  invocations_by_pk(id: $id) {
    id
    created_at
    updated_at
    correlation_id
    source_function
    source_table
    source_operation
    source_system
    source_event_id
    source_event_payload
    source_event_time
    source_user_email
    source_user_role
    total_duration_ms
    events_detected_count
    total_jobs_run
    total_jobs_succeeded
    total_jobs_failed
    auto_load_modules
    event_modules_directory
    status
    error_message
    error_stack
    context_data

    event_executions {
      id
      created_at
      updated_at
      correlation_id
      event_name
      event_module_path
      detected
      detection_duration_ms
      detection_error
      detection_error_stack
      handler_duration_ms
      handler_error
      handler_error_stack
      jobs_count
      jobs_succeeded
      jobs_failed
      status

      job_executions {
        id
        created_at
        updated_at
        correlation_id
        job_name
        job_function_name
        job_options
        duration_ms
        status
        result
        error_message
        error_stack
      }
    }
  }
}

query CorrelationSearch($searchTerm: String!, $hasColon: Boolean = false, $tablePart: String = "", $idPart: String = "") {
  invocations(
    where: {
      _or: [
        { correlation_id: { _ilike: $searchTerm } }
        { source_function: { _ilike: $searchTerm } }
        { source_user_email: { _ilike: $searchTerm } }
        { source_event_payload: { _cast: { String: { _ilike: $searchTerm } } } }
        {
          _and: [
            { source_table: { _ilike: $tablePart } }
            { source_event_payload: { _cast: { String: { _ilike: $idPart } } } }
          ]
        }
      ]
    }
    order_by: { created_at: desc }
    limit: 20
  ) {
    id
    correlation_id
    source_function
    source_table
    source_user_email
    source_event_payload
    created_at
    status
    total_duration_ms
    events_detected_count
    total_jobs_run
  }
}