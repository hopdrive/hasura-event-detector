query EventFlow($invocationId: uuid!) {
  invocations_by_pk(id: $invocationId) {
    id
    source_function
    status
    total_duration_ms
    events_detected_count
    correlation_id

    event_executions {
      id
      event_name
      detected
      status
      detection_duration_ms
      handler_duration_ms
      jobs_count

      job_executions {
        id
        job_name
        job_function_name
        status
        duration_ms
        result
        error_message
      }
    }
  }
}

query CorrelationChainsList($limit: Int = 20) {
  invocations(
    where: { correlation_id: { _is_null: false } }
    distinct_on: correlation_id
    order_by: [{ correlation_id: asc }, { created_at: desc }]
    limit: $limit
  ) {
    correlation_id
    created_at

    source_function
  }
}

query CorrelationChainFlow($correlationId: String!) {
  invocations(
    where: { correlation_id: { _eq: $correlationId } }
    order_by: { created_at: asc }
  ) {
    id
    source_function
    created_at
    status
    total_duration_ms
    events_detected_count
    correlation_id

    event_executions {
      id
      event_name
      detected
      status
      detection_duration_ms
      handler_duration_ms
      jobs_count
      jobs_succeeded
      jobs_failed

      job_executions {
        id
        job_name
        job_function_name
        status
        duration_ms
        result
        error_message
        correlation_id
        created_at
      }
    }
  }
}